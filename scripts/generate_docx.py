from pathlib import Path

OUTPUT = Path(__file__).resolve().parents[1] / "docs" / "CNC_Pulse_Monitor_Documentation.md"

sections = [
    "# CNC Pulse Monitor",
    "## Титульная страница\nНазвание системы: **CNC Pulse Monitor**",
    "## Введение\nНазначение системы, общее описание.",
    "## Аппаратная часть\n- Список компонентов (модели, ссылки для заказа).\n- Принципиальная электрическая схема (см. `docs/hardware/cnc_pulse_monitor.kicad_sch`).\n- Инструкция по сборке модуля.\n  - [СКРИНШОТ: Собранный модуль]\n- Инструкция по подключению к станку (с ВАРНИНГАМИ о безопасности при работе с высоким напряжением).",
    "### Важные предупреждения по безопасности\n- Все работы с цепями 220/380В выполняются только при снятом напряжении и квалифицированным персоналом.\n- Используйте гальваническую развязку (оптопары, изолированные трансформаторы напряжения/тока) между силовыми цепями и ESP32.\n- Применяйте защитные автоматы и УЗО в соответствии с локальными нормами.",
    "### PoC: датчик температуры DS18B20\n1. Подключите DS18B20 к 3.3В, GND и GPIO4 (с подтягивающим резистором 4.7 кОм между DATA и 3.3В).\n2. Установите `OneWire` и `DallasTemperature` библиотеки в PlatformIO.\n3. Прошивка: `firmware/src/main.cpp` уже читает температуру и отправляет в backend.\n4. Backend: `POST /metrics` сохраняет значения в БД.\n5. Frontend: график температуры появляется на дашборде.",
    "## Установка и настройка ПО\n- Прошивка ESP32 (как загрузить код, как записать `config.json` на SD).\n  - [СКРИНШОТ: Окно PlatformIO]\n- Установка сервера (Docker-команды или ручная установка).\n  - [СКРИНШОТ: Успешный запуск сервера в терминале]\n- Первоначальная настройка веб-интерфейса.",
    "## Руководство пользователя (для оператора станка)\n- Как зайти в веб-интерфейс.\n  - [СКРИНШОТ: Страница логина]\n- Обзор панели мониторинга.\n  - [СКРИНШОТ: Основной дашборд]\n- Как просмотреть журнал событий.\n  - [СКРИНШОТ: Вкладка \"Журнал\"]\n- Как отправить логи инженеру.\n  - [СКРИНШОТ: Вкладка \"Диагностика\"]\n- Как внести запись о проведенном обслуживании.\n  - [СКРИНШОТ: Форма добавления записи ТО]",
    "## Руководство инженера/администратора\n- Настройка порогов аварий и параметров.\n  - [СКРИНШОТ: Админ-панель \"Настройки\"]\n- Работа с инженерным ПО: пошаговый разбор случая.\n  - [СКРИНШОТ: Графики в десктоп-приложении]\n- Методика анализа спектра вибрации.",
    "## Приложения\n- JSON-схемы конфигурационных файлов (см. `docs/config_schema.json`).\n- FAQ по проблемам.",
]

OUTPUT.parent.mkdir(parents=True, exist_ok=True)
OUTPUT.write_text("\n\n".join(sections), encoding="utf-8")
print(f"Generated {OUTPUT}")
